{"version":3,"file":"modules.js","names":["_nodeServerEngine","require","_multer","_interopRequireDefault","_expressValidator","_modules","_modules2","_middleware","_modules3","upload","multer","storage","memoryStorage","validateRequest","req","res","next","errors","validationResult","isEmpty","status","json","array","createModuleEndpoint","exports","Endpoint","path","method","EndpointMethod","POST","authType","EndpointAuthType","JWT","handler","console","log","JSON","stringify","body","moduleName","response","createModuleHandler","file","success","error","message","moduleId","materialForModule","validator","middleware","checkPermission","single","getAllModuleEndpoint","GET","module","getAllModulesHandler","MODULE_NOT_FOUND","MODULE_GET_ERROR","getModuleByIdEndpoint","params","id","getModuleByIdHandler","getModuleByIdValidator","updateModuleByIdEndpoint","PUT","updateModule","updateModuleHandler","MODULE_UPDATE_ERROR","deleteModuleEndpoint","DELETE","deleteModuleHandler","MODULE_DELETION_ERROR","deleteModuleValidator"],"sources":["../../../src/endpoints/modules/modules.ts"],"sourcesContent":["import { Endpoint, EndpointAuthType, EndpointMethod } from 'node-server-engine';\r\nimport multer from 'multer';\r\nimport { Request, Response, NextFunction  } from 'express';\r\nimport { validationResult } from 'express-validator';\r\nimport {\r\n  createModuleHandler,\r\n  updateModuleHandler,\r\n  getModuleByIdHandler,\r\n  deleteModuleHandler,\r\n  getAllModulesHandler\r\n} from './modules.handler';\r\nimport {\r\n  createModuleValidator,\r\n  updateModuleValidator,\r\n  getModuleByIdValidator,\r\n  deleteModuleValidator\r\n} from './modules.validator';\r\nimport { checkPermission } from 'middleware';\r\nimport {\r\n  MODULE_NOT_FOUND,\r\n  MODULE_CREATION_ERROR,\r\n  MODULE_UPDATE_ERROR,\r\n  MODULE_DELETION_ERROR,\r\n  MODULE_GET_ERROR,\r\n  COURSE_NOT_FOUND\r\n} from './modules.const';\r\n\r\n// Multer Memory Storage for handling file uploads\r\nconst upload = multer({ storage: multer.memoryStorage() });\r\n\r\n// Middleware to handle validation errors\r\nconst validateRequest = (req: Request, res: Response, next: NextFunction) => {\r\n  const errors = validationResult(req);\r\n  if (!errors.isEmpty()) {\r\n    return res.status(400).json({ errors: errors.array() });\r\n  }\r\n  next(); // Proceed to the next middleware/function if no errors\r\n};\r\n\r\n//CREATE MODULE\r\nexport const createModuleEndpoint = new Endpoint({\r\n  path: '/module',\r\n  method: EndpointMethod.POST,\r\n  authType: EndpointAuthType.JWT,\r\n  handler: async (req: Request, res: Response): Promise<void> => {\r\n    try {\r\n     \r\n      console.log('Incoming request body:', JSON.stringify(req.body, null, 2));\r\n      console.log('Received moduleName:', req.body.moduleName);\r\n\r\n      // Call handler with request body and file\r\n      const response = await createModuleHandler(req, req.body, req.file);\r\n\r\n      if (!response.success) {\r\n        res.status(400).json({ error: response.message });\r\n        return \r\n      }\r\n\r\n      res.status(201).json({\r\n        message: 'Module created successfully',\r\n        moduleId: response.moduleId,\r\n        materialForModule: response.materialForModule,\r\n      });\r\n    } catch (error) {\r\n      console.error('Error creating Module:', error);\r\n      res.status(500).json({message: 'Internal server error', error: \"error\" });\r\n    }\r\n  },\r\n  validator: {}, // Apply the schema-based validator\r\n  middleware: [checkPermission(\"CreateModule\"), upload.single('materialForModule'), validateRequest]\r\n});\r\n\r\n\r\n// Get All Module Endpoint\r\nexport const getAllModuleEndpoint = new Endpoint({\r\n  path: '/module',\r\n  method: EndpointMethod.GET,\r\n  handler: async (req, res): Promise<void> => {\r\n    try {\r\n      const module = await getAllModulesHandler();\r\n\r\n      if (!module) {\r\n        res.status(404).json({ message: MODULE_NOT_FOUND });\r\n        return;\r\n      }\r\n\r\n      res.status(200).json({\r\n        message: 'Module retrieved successfully',\r\n        module\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({ message: MODULE_GET_ERROR, error });\r\n    }\r\n  },\r\n  authType: EndpointAuthType.JWT,\r\n  validator: {},\r\n  middleware: [checkPermission(\"GetModule\")]\r\n\r\n});\r\n\r\n// Get Module By ID Endpoint\r\nexport const getModuleByIdEndpoint = new Endpoint({\r\n  path: '/module/:id',\r\n  method: EndpointMethod.GET,\r\n  handler: async (req: Request, res: Response): Promise<void> => {\r\n    try {\r\n      const moduleId = req.params.id; // Ensure this is used correctly\r\n      const module = await getModuleByIdHandler(moduleId);\r\n      res.status(200).json({\r\n        message: 'Module retrieved successfully',\r\n        module\r\n      });\r\n    } catch (error) {\r\n      res.status(404).json({ message: MODULE_NOT_FOUND, error });\r\n    }\r\n  },\r\n  authType: EndpointAuthType.JWT,\r\n  validator: getModuleByIdValidator,\r\n  middleware: [checkPermission(\"GetModule\")]\r\n\r\n});\r\n\r\n// Update Module Endpoint\r\nexport const updateModuleByIdEndpoint = new Endpoint({\r\n  path: '/module/:id',\r\n  method: EndpointMethod.PUT,\r\n\r\n  handler: async (req, res): Promise<void> => {\r\n    try {\r\n      const updateModule = await updateModuleHandler(req, req.params.id, req.body);\r\n      res\r\n        .status(200)\r\n        .json({ message: 'Module updated successfully', updateModule });\r\n    } catch (error) {\r\n      res.status(500).json({ message: MODULE_UPDATE_ERROR, error });\r\n    }\r\n  },\r\n  authType: EndpointAuthType.JWT,\r\n  validator: {},\r\n  middleware: [checkPermission(\"UpdateModule\"), upload.single('materialForModule') ]\r\n});\r\n\r\n// Delete module Endpoint\r\nexport const deleteModuleEndpoint = new Endpoint({\r\n  path: '/module/:id',\r\n  method: EndpointMethod.DELETE,\r\n  handler: async (req, res): Promise<void> => {\r\n    try {\r\n      await deleteModuleHandler(req, req.params.id);\r\n      res.json({ message: 'Module deleted successfully' });\r\n    } catch (error) {\r\n      res.status(500).json({ message: MODULE_DELETION_ERROR, error });\r\n    }\r\n  },\r\n  authType: EndpointAuthType.JWT,\r\n  validator: deleteModuleValidator,\r\n  middleware: [checkPermission(\"DeleteModule\")] \r\n});\r\n"],"mappings":"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","ignoreList":[]}
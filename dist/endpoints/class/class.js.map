{"version":3,"file":"class.js","names":["_nodeServerEngine","require","_multer","_interopRequireDefault","_class","_class2","_middleware","_class3","upload","multer","storage","memoryStorage","createClassEndpoint","exports","Endpoint","path","method","EndpointMethod","POST","authType","EndpointAuthType","JWT","validator","middleware","checkPermission","fields","name","maxCount","handler","req","res","console","log","headers","body","files","classTitle","status","json","error","response","createClassHandler","materialForClass","undefined","assignmentFile","success","message","CLASS_CREATION_ERROR","getAllClassEndpoint","GET","classes","getAllClassesHandler","CLASS_NOT_FOUND","CLASS_GET_ERROR","NONE","getClassByIdEndpoint","classId","params","id","classData","getClassByIdHandler","class","getClassByModuleIdEndpoint","moduleId","getClassByModuleIdHandler","updateClassByIdEndpoint","PUT","updateClass","updateClassHandler","errors","deleteClassEndpoint","DELETE","deleteClassHandler","CLASS_DELETION_ERROR","deleteClassValidator"],"sources":["../../../src/endpoints/class/class.ts"],"sourcesContent":["import { Endpoint, EndpointMethod, EndpointAuthType } from 'node-server-engine';\r\nimport multer from 'multer';\r\nimport { Request, Response } from 'express';\r\nimport {\r\n  classValidator,\r\n  updateClassValidator,\r\n  deleteClassValidator\r\n} from './class.validator';\r\nimport {\r\n  getAllClassesHandler,\r\n  createClassHandler,\r\n  getClassByIdHandler,\r\n  updateClassHandler,\r\n  deleteClassHandler,\r\n  getClassByModuleIdHandler\r\n} from './class.handler';\r\nimport { checkPermission } from 'middleware';\r\n\r\nimport {\r\n  CLASS_NOT_FOUND,\r\n  CLASS_CREATION_ERROR,\r\n  CLASS_UPDATE_ERROR,\r\n  CLASS_DELETION_ERROR,\r\n  CLASS_GET_ERROR\r\n} from './class.const';\r\n\r\n// Multer Memory Storage for handling file uploads\r\nconst upload = multer({ storage: multer.memoryStorage() });\r\n\r\n// Create class Endpoint\r\nexport const createClassEndpoint = new Endpoint({\r\n  path: \"/class\",\r\n  method: EndpointMethod.POST,\r\n  authType: EndpointAuthType.JWT,\r\n  validator: {},\r\n  middleware: [\r\n    checkPermission(\"CreateClass\"),\r\n    upload.fields([\r\n      { name: \"materialForClass\", maxCount: 1 },\r\n      { name: \"assignmentFile\", maxCount: 1 }\r\n    ])\r\n  ],\r\n\r\n  handler: async (req: Request, res: Response): Promise<void> => {\r\n    try {\r\n      console.log(\"Incoming request:\", {\r\n        headers: req.headers,\r\n        body: req.body,\r\n        files: req.files, // Log all uploaded files\r\n      });\r\n\r\n      // Ensure classTitle is present\r\n      if (!req.body.classTitle) {\r\n        res.status(400).json({ error: \"classTitle is required\" });\r\n        return;\r\n      }\r\n\r\n      // Extract files from request\r\n      const files = req.files as {\r\n        materialForClass?: Express.Multer.File[];\r\n        assignmentFile?: Express.Multer.File[];\r\n      };\r\n\r\n      // Call handler with request body and extracted files\r\n      const response = await createClassHandler(\r\n        req,\r\n        req.body,\r\n        {\r\n          materialForClass: files.materialForClass ? files.materialForClass[0] : undefined,\r\n          assignmentFile: files.assignmentFile ? files.assignmentFile[0] : undefined\r\n        }\r\n      );\r\n\r\n      if (!response.success) {\r\n        res.status(400).json({ error: response.message });\r\n        return;\r\n      }\r\n\r\n      res.status(201).json({\r\n        message: \"Class created successfully\",\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error creating class:\", error);\r\n      res.status(500).json({ message: CLASS_CREATION_ERROR, error });\r\n    }\r\n  },\r\n});\r\n\r\n// Get All Class Endpoint\r\nexport const getAllClassEndpoint = new Endpoint({\r\n  path: '/class',\r\n  method: EndpointMethod.GET,\r\n  handler: async (req, res): Promise<void> => {\r\n    try {\r\n      const classes = await getAllClassesHandler();\r\n\r\n      if (!classes) {\r\n        res.status(404).json({ message: CLASS_NOT_FOUND });\r\n        return;\r\n      }\r\n\r\n      res.status(200).json({\r\n        message: 'Class retrieved successfully',\r\n        classes\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({ message: CLASS_GET_ERROR, error });\r\n    }\r\n  },\r\n  authType: EndpointAuthType.NONE,\r\n  validator: {},\r\n  // middleware: [checkPermission(\"GetClass\")]\r\n});\r\n\r\n// Get Class By ID Endpoint\r\nexport const getClassByIdEndpoint = new Endpoint({\r\n  path: '/class/:id',\r\n  method: EndpointMethod.GET,\r\n  handler: async (req: Request, res: Response): Promise<void> => {\r\n    try {\r\n      const classId = req.params.id; // Ensure this is used correctly\r\n      const classData = await getClassByIdHandler(classId);\r\n      res.status(200).json({\r\n        message: 'Class retrieved successfully',\r\n        class: classData\r\n      });\r\n    } catch (error) {\r\n      res.status(404).json({ message: CLASS_NOT_FOUND, error });\r\n    }\r\n  },\r\n  authType: EndpointAuthType.NONE,\r\n  validator: {},\r\n  // middleware: [checkPermission(\"GetClass\")]\r\n});\r\n\r\n// Get Class By ID Endpoint\r\nexport const getClassByModuleIdEndpoint = new Endpoint({\r\n  path: '/classbyModule/:id',\r\n  method: EndpointMethod.GET,\r\n  handler: async (req: Request, res: Response): Promise<void> => {\r\n    try {\r\n      const moduleId = req.params.id; // Ensure this is used correctly\r\n      const classData = await getClassByModuleIdHandler(moduleId);\r\n      res.status(200).json({\r\n        message: 'Class retrieved successfully',\r\n        class: classData\r\n      });\r\n    } catch (error) {\r\n      res.status(404).json({ message: CLASS_NOT_FOUND, error });\r\n    }\r\n  },\r\n  authType: EndpointAuthType.NONE,\r\n  validator: {},\r\n  // middleware: [checkPermission(\"GetClass\")]\r\n});\r\n\r\n// Update classbyid Endpoint\r\nexport const updateClassByIdEndpoint = new Endpoint({\r\n  path: \"/class/:id\",\r\n  method: EndpointMethod.PUT,\r\n\r\n  handler: async (req, res): Promise<void> => {\r\n    try {\r\n      const files = req.files as { [key: string]: Express.Multer.File[] } | undefined;\r\n\r\n      const updateClass = await updateClassHandler(req, req.params.id, req.body, {\r\n        materialForClass: files?.materialForClass,\r\n        assignmentFile: files?.assignmentFile,\r\n      });\r\n\r\n      if (!updateClass.success) {\r\n        res.status(400).json({ message: \"Failed to update class\", errors: updateClass.errors });\r\n        return;\r\n      }\r\n\r\n      res.status(200).json({ message: \"Class updated successfully\", classData: updateClass.classData });\r\n    } catch (error) {\r\n      console.error(\"Error in updateClassByIdEndpoint:\", error);\r\n      res.status(500).json({ message: \"Internal server error while updating class\", error });\r\n    }\r\n  },\r\n\r\n  authType: EndpointAuthType.JWT,\r\n  validator: {},\r\n\r\n  middleware: [\r\n    checkPermission(\"UpdateClass\"),\r\n    upload.fields([\r\n      { name: \"materialForClass\", maxCount: 1 },\r\n      { name: \"assignmentFile\", maxCount: 1 },\r\n    ]),\r\n  ],\r\n});\r\n\r\n\r\n\r\n// Delete Class Endpoint\r\nexport const deleteClassEndpoint = new Endpoint({\r\n  path: '/class/:id',\r\n  method: EndpointMethod.DELETE,\r\n  handler: async (req, res): Promise<void> => {\r\n    try {\r\n      await deleteClassHandler(req, req.params.id);\r\n      res.json({ message: 'Class deleted successfully' });\r\n    } catch (error) {\r\n      res.status(500).json({ message: CLASS_DELETION_ERROR, error });\r\n    }\r\n  },\r\n  authType: EndpointAuthType.JWT,\r\n  validator: deleteClassValidator,\r\n  middleware: [checkPermission(\"DeleteClass\")] \r\n});\r\n"],"mappings":"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","ignoreList":[]}
{"version":3,"file":"attendanceQueries.js","names":["attendanceQueries","exports","checkTableExists","process","env","PROJECT_ID","DATASET_ID","createAttendanceTable","TABLE_ATTENDANCE","validateBatchId","TABLE_BATCH","validateModuleId","TABLE_MODULE","validateClassId","TABLE_CLASS","validateAttendanceFileId","TABLE_ATTENDANCE_FILE","findUserByEmail","TABLE_USER","validateAttendanceFile","insertAttendance","getAllAttendance","TABLE_ROLE","TABLE_COURSE","getAttendanceById","updateAttendance","deleteAttendance"],"sources":["../../../src/queries/attendance/attendanceQueries.ts"],"sourcesContent":["export const attendanceQueries = {\r\n  // Check if a table exists in BigQuery\r\n  checkTableExists: `\r\n    SELECT table_name \r\n    FROM \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.INFORMATION_SCHEMA.TABLES\\` \r\n    WHERE table_name = @tableName\r\n  `,\r\n\r\n  // Create Attendance Table\r\n  createAttendanceTable: `\r\n    CREATE TABLE \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_ATTENDANCE}\\` (\r\n      id STRING NOT NULL,\r\n      userId STRING NOT NULL,\r\n      batchId STRING NOT NULL,\r\n      courseId STRING NOT NULL,\r\n      moduleId STRING NOT NULL,\r\n      classId STRING NOT NULL,\r\n      firstJoin TIMESTAMP,\r\n      lastLeave TIMESTAMP,\r\n      email STRING NOT NULL,\r\n      percentage FLOAT64,\r\n      duration INT64,\r\n      teamsRole STRING,\r\n      attendance BOOL,\r\n      attendanceFileId STRING,\r\n      createdBy STRING, \r\n      createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n    )\r\n  `,\r\n\r\n  // ✅ Validate if batchId exists\r\n  validateBatchId: `\r\n    SELECT id FROM \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_BATCH}\\` WHERE id = @batchId\r\n  `,\r\n\r\n  // ✅ Validate if moduleId exists\r\n  validateModuleId: `\r\n    SELECT id FROM \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_MODULE}\\` WHERE id = @moduleId\r\n  `,\r\n\r\n  // ✅ Validate if classId exists\r\n  validateClassId: `\r\n    SELECT id FROM \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_CLASS}\\` WHERE id = @classId\r\n  `,\r\n\r\n  // ✅ Validate if attendanceFileId exists\r\n  validateAttendanceFileId: `\r\n    SELECT id FROM \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_ATTENDANCE_FILE}\\` WHERE id = @attendanceFileId\r\n  `,\r\n\r\n  // ✅ Validate if user exists by email\r\n  findUserByEmail: `\r\n    SELECT id FROM \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_USER}\\` WHERE email = @email\r\n  `,\r\n\r\n  // ✅ Validate if attendanceFileId exists in attendanceFiles table\r\n  validateAttendanceFile: `\r\n    SELECT id FROM \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_ATTENDANCE_FILE}\\` WHERE id = @attendanceFileId\r\n  `,\r\n\r\n  // ✅ Insert Attendance Record\r\n  insertAttendance: `\r\n    INSERT INTO \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_ATTENDANCE}\\` (\r\n      id, userId, batchId, courseId, moduleId, classId, firstJoin, lastLeave, email, \r\n      percentage, duration, teamsRole, attendance, attendanceFileId, createdAt, updatedAt\r\n    ) VALUES (\r\n      @id, @userId, @batchId, @courseId, @moduleId, @classId, @firstJoin, @lastLeave, @email, \r\n      @percentage, @duration, @teamsRole, @attendance, @attendanceFileId, @createdAt, @updatedAt\r\n    )\r\n  `,\r\n\r\n  // ✅ Get all attendance records\r\n  getAllAttendance: `\r\n  SELECT \r\n    att.id AS attendanceId,\r\n    \r\n    -- User Details\r\n    att.userId AS userId,\r\n    CONCAT(u.firstName, ' ', u.lastName) AS userName,\r\n\r\n    -- role Details\r\n    role.id AS roleId,\r\n    role.name AS roleName,\r\n\r\n    -- Batch Details\r\n    att.batchId AS batchId,\r\n    b.batchName AS batchName,\r\n\r\n    -- Course Details\r\n    att.courseId AS courseId,\r\n    c.courseName AS courseName,\r\n\r\n    -- Module Details\r\n    att.moduleId AS moduleId,\r\n    m.moduleName AS moduleName,\r\n\r\n    -- Class Details\r\n    att.classId AS classId,\r\n    cls.classTitle AS classTitle,\r\n\r\n    -- Attendance Data\r\n    att.firstJoin AS firstJoin,\r\n    att.lastLeave AS lastLeave,\r\n    att.duration AS duration,\r\n    att.email AS email,\r\n    att.teamsRole AS teamsRole,\r\n    att.attendance AS attendance,\r\n    att.percentage AS percentage,\r\n\r\n  FROM \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_ATTENDANCE}\\` att\r\n  \r\n  -- Joining User Table\r\n  LEFT JOIN \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_USER}\\` u \r\n    ON att.userId = u.id\r\n\r\n    LEFT JOIN \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_ROLE}\\` role \r\n    ON u.roleId = role.id\r\n\r\n  -- Joining Batch Table\r\n  LEFT JOIN \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_BATCH}\\` b \r\n    ON att.batchId = b.id\r\n\r\n  -- Joining Course Table\r\n  LEFT JOIN \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_COURSE}\\` c \r\n    ON att.courseId = c.id\r\n\r\n  -- Joining Module Table\r\n  LEFT JOIN \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_MODULE}\\` m \r\n    ON att.moduleId = m.id\r\n\r\n  -- Joining Class Table\r\n  LEFT JOIN \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_CLASS}\\` cls \r\n    ON att.classId = cls.id\r\n`,\r\n\r\n  // ✅ Get attendance by ID\r\n  getAttendanceById: `\r\n    SELECT * FROM \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_ATTENDANCE}\\`\r\n    WHERE id = @id\r\n  `,\r\n\r\n  // ✅ Update Attendance\r\n  updateAttendance: `\r\nUPDATE \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_ATTENDANCE}\\`\r\nSET \r\n  batchId = @batchId,\r\n  courseId = @courseId,\r\n  moduleId = @moduleId,\r\n  firstJoin = @firstJoin,\r\n  lastLeave = @lastLeave,\r\n  duration = @duration,\r\n  email = @email,\r\n  teamsRole = @teamsRole,\r\n  attendance = @attendance,\r\n  attendanceFileId = @attendanceFileId,\r\n  updatedAt = CURRENT_TIMESTAMP()\r\nWHERE classId = @classId;\r\n\r\n  `,\r\n\r\n  // ✅ Delete Attendance\r\n  deleteAttendance: `\r\n    DELETE FROM \\`${process.env.PROJECT_ID}.${process.env.DATASET_ID}.${process.env.TABLE_ATTENDANCE}\\`\r\n    WHERE classId = @classId\r\n  `\r\n};\r\n"],"mappings":"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","ignoreList":[]}